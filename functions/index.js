!function(n,t){for(var e in t)n[e]=t[e]}(this,function(n){var t={};function e(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return n[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=n,e.c=t,e.d=function(n,t,i){e.o(n,t)||Object.defineProperty(n,t,{configurable:!1,enumerable:!0,get:i})},e.r=function(n){Object.defineProperty(n,"__esModule",{value:!0})},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e.w={},e(e.s=14)}([function(n,t){n.exports=require("firebase-functions")},function(n,t){n.exports="\ninput OrgProfileInput  {\n  about : String\n  name : String\n}\n\ntype OrgProfile  {\n  about : String\n  name : String\n}\n\ninput OrganizationInput {\n  id: String!\n  created_at : String\n  members : String\n  profile : OrgProfileInput\n  slug : String\n  streams : String\n}\n\ninput OrganizationCreateInput {\n  created_at : String\n  members : String\n  profile : OrgProfileInput\n  slug : String\n  streams : String\n}\n\ninput OrganizationDeleteInput {\n  id: String!\n}\ntype Organization {\n  id: String!\n  created_at : String\n  members : String\n  profile : OrgProfile\n  slug : String\n  streams : String\n}"},function(n,t){n.exports="\ninput GroupInput {\n  id: String!\n  created_at : String\n  created_by :String\n  description : String\n  members :String\n  name : String\n  oid : String\n  updated_at : String\n  updated_by : String\n}\n\ninput GroupCreateInput {\n  created_at : String\n  created_by :String\n  description : String\n  members :String\n  name : String\n  oid : String\n  updated_at : String\n  updated_by : String\n}\n\ninput GroupDeleteInput {\n  id: String!\n}\ntype Group {\n  id: String!\n  created_at : String\n  created_by :String\n  description : String\n  members :String\n  name : String\n  oid : String\n  updated_at : String\n  updated_by : String\n}"},function(n,t){n.exports="\n\ninput auth_input {\n  firebase_id : String\n  provider : String\n}\n\ntype auth {\n  firebase_id : String\n  provider : String\n}\n\n\ninput ProfileRawInput {\n  emailAddress : String\n  firstName : String\n  headline :String\n  id : String\n  lastName : String\n  pictureUrl :String\n  publicProfileUrl :String\n}\n\ntype ProfileRaw {\n  emailAddress : String\n  firstName : String\n  headline :String\n  id : String\n  lastName : String\n  pictureUrl :String\n  publicProfileUrl :String\n}\n\ninput Profile_input  {\n  avatar : String\n  bio :String\n  email : String\n  firstname : String\n  id : String\n  lastname :String\n  name : String\n  raw : ProfileRawInput\n  url :String\n}\n\ntype Profile  {\n  avatar : String\n  bio :String\n  email : String\n  firstname : String\n  id : String\n  lastname :String\n  name : String\n  raw : ProfileRaw\n  url :String\n}\n\n\ninput TimeInput {\n  daypart : String\n  hour : String\n  minute : String\n}\n\ntype Time {\n  daypart : String\n  hour : String\n  minute : String\n}\n\n\n\ninput Default_SchedulesInput {\n  opt_in : Boolean\n  timezone : String\n  posting_times : [TimeInput]\n}\n\ntype Default_Schedules {\n  opt_in : Boolean\n  timezone : String\n  posting_times : [Time]\n}\n\ninput SchedulesInput {\n  default : Default_SchedulesInput\n\n}\n\ntype Schedules {\n  default : Default_Schedules\n}\n\ninput ConnectionPubishSettingsInput {\n  schedules : SchedulesInput\n}\n\ntype  ConnectionPubishSettings {\n  schedules : Schedules\n}\n\ninput ConnectionPublishInput {\n  settings : ConnectionPubishSettingsInput\n}\n\ntype ConnectionPublish {\n  settings : ConnectionPubishSettings\n}\n\n\ninput ConnectionCreateInput {\n  auth: auth_input\n  created_at : String\n  created_by : String\n  ignore : Boolean\n  name : String\n  oid : String\n  profile : Profile_input\n  publish: ConnectionPublishInput\n  source : String\n  source_type : String\n  status : String\n  type : String\n  uid : String\n  version : String\n}\n\ninput ConnectionInput {\n  id: String\n  auth: auth_input\n  created_at : String\n  created_by : String\n  ignore : Boolean\n  name : String\n  oid : String\n  profile : Profile_input\n  publish: ConnectionPublishInput\n  source : String\n  source_type : String\n  status : String\n  type : String\n  uid : String\n  version : String\n}\n\ninput ConnectionDeleteInput {\n  id: String!\n}\n\ntype Connection {\n  id: String!\n  auth: auth\n  created_at : String\n  created_by : String\n  ignore : Boolean\n  name : String\n  oid : String\n  profile : Profile\n  publish: ConnectionPublish\n  source : String\n  source_type : String\n  status : String\n  type : String\n  uid : String\n  version : String\n}"},function(n,t){n.exports="\n\ninput DeviceCreateInput {\n  endpointId: String\n}\n\ninput DeviceInput {\n  id: String\n  endpointId: String\n}\n\ninput DeviceDeleteInput {\n  id: String!\n}\ntype Device {\n  id: String!\n  endpointId : String\n}"},function(n,t){n.exports="\ntype Settings {\n  opt_in : Boolean,\n  timezone : String\n}\ntype Publish {\n  settings : Settings \n  status : String,\n  updated_at : String\n}\n\ninput ApprovalCreateInput {\n  category : String\n  connection_id : String\n  content : String\n  created_at : Int,\n  created_by : String\n  edited_by : String\n  image : String\n  oid : String\n  original_content : String\n  source : String\n  status : String\n  uid : String\n  updated_at : String\n  updated_by : String\n}\n\ninput ApprovalInput {\n  id: String\n  category : String\n  connection_id : String\n  content : String\n  created_at : Int,\n  created_by : String\n  edited_by : String\n  image : String\n  oid : String\n  original_content : String\n  source : String\n  status : String\n  uid : String\n  updated_at : String\n  updated_by : String\n}\ninput ApprovalDeleteInput {\n  id: String!\n}\ntype Approval {\n  id: String!\n  category : String\n  connection_id : String\n  content : String\n  created_at : Int,\n  created_by : String\n  edited_by : String\n  image : String\n  oid : String\n  original_content : String\n  publish :  Publish \n  publish_at : String\n  publish_at_str : String\n  publish_date : String\n  publish_status : String\n  source : String\n  status : String\n  uid : String\n  updated_at : String\n  updated_by : String\n}"},function(n,t){n.exports=require("firebase-admin")},function(n,t,e){var i=this&&this.__awaiter||function(n,t,e,i){return new(e||(e=Promise))(function(r,o){function u(n){try{s(i.next(n))}catch(n){o(n)}}function a(n){try{s(i.throw(n))}catch(n){o(n)}}function s(n){n.done?r(n.value):new e(function(t){t(n.value)}).then(u,a)}s((i=i.apply(n,t||[])).next())})};const r=e(6);e(0);r.initializeApp();const o=r.database().ref("approvals"),u=r.database().ref("devices"),a=r.database().ref("connections"),s=r.database().ref("groups"),d=r.database().ref("organizations");n.exports={Query:{approvals(n,{},{token:t}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(t);return o.once("value").then(n=>{const t=n.val();return null===t?[]:Object.keys(t).map(n=>Object.assign({id:n},t[n]))})})},approval(n,{id:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);return r.database().ref(`approvals/${t}`).once("value").then(n=>{const e=n.val();return Object.assign({id:t},e)})})},devices(n,{},{token:t}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(t);return u.once("value").then(n=>{const t=n.val();return null===t?[]:Object.keys(t).map(n=>Object.assign({id:n},t[n]))})})},device(n,{id:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);return r.database().ref(`devices/${t}`).once("value").then(n=>{const e=n.val();return Object.assign({id:t},e)})})},connections(n,{},{token:t}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(t);return a.once("value").then(n=>{const t=n.val();return null===t?[]:Object.keys(t).map(n=>Object.assign({id:n},t[n]))})})},connection(n,{id:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);return r.database().ref(`connections/${t}`).once("value").then(n=>{const e=n.val();return Object.assign({id:t},e)})})},groups(n,{},{token:t}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(t);return s.once("value").then(n=>{const t=n.val();return null===t?[]:Object.keys(t).map(n=>Object.assign({id:n},t[n]))})})},group(n,{id:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);return r.database().ref(`groups/${t}`).once("value").then(n=>{const e=n.val();return Object.assign({id:t},e)})})},organizations(n,{},{token:t}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(t);return d.once("value").then(n=>{const t=n.val();return null===t?[]:Object.keys(t).map(n=>Object.assign({id:n},t[n]))})})},organization(n,{id:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);return r.database().ref(`oraganizations/${t}`).once("value").then(n=>{const e=n.val();return Object.assign({id:t},e)})})}},Mutation:{createApproval(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);return new Promise(n=>{const e=o.push(t,()=>{n(Object.assign({id:e.key},t))})})})},updateApproval(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);const n=o.child(t.id);return n.once("value").then(n=>{const t=n.val();if(null===t)throw new Error("404");return t}).then(e=>{const i=Object.assign(e,t);return delete i.id,n.set(i).then(()=>Object.assign({id:t.id},i))})})},deleteApproval(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);const n=o.child(t.id);return n.once("value").then(n=>{const e=n.val();if(null===e)throw new Error("404");return Object.assign({id:t.id},e)}).then(t=>n.remove().then(()=>t))})},createDevice(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);return new Promise(n=>{const e=u.push(t,()=>{n(Object.assign({id:e.key},t))})})})},updateDevice(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);const n=u.child(t.id);return n.once("value").then(n=>{const t=n.val();if(null===t)throw new Error("404");return t}).then(e=>{const i=Object.assign(e,t);return delete i.id,n.set(i).then(()=>Object.assign({id:t.id},i))})})},deleteDevice(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);const n=u.child(t.id);return n.once("value").then(n=>{const e=n.val();if(null===e)throw new Error("404");return Object.assign({id:t.id},e)}).then(t=>n.remove().then(()=>t))})},createConnection(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);return new Promise(n=>{const e=a.push(t,()=>{n(Object.assign({id:e.key},t))})})})},updateConnection(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);const n=a.child(t.id);return n.once("value").then(n=>{const t=n.val();if(null===t)throw new Error("404");return t}).then(e=>{const i=Object.assign(e,t);return delete i.id,n.set(i).then(()=>Object.assign({id:t.id},i))})})},deleteConnection(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);const n=a.child(t.id);return n.once("value").then(n=>{const e=n.val();if(null===e)throw new Error("404");return Object.assign({id:t.id},e)}).then(t=>n.remove().then(()=>t))})},createGroup(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);return new Promise(n=>{const e=s.push(t,()=>{n(Object.assign({id:e.key},t))})})})},updateGroup(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);const n=s.child(t.id);return n.once("value").then(n=>{const t=n.val();if(null===t)throw new Error("404");return t}).then(e=>{const i=Object.assign(e,t);return delete i.id,n.set(i).then(()=>Object.assign({id:t.id},i))})})},deleteGroup(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);const n=s.child(t.id);return n.once("value").then(n=>{const e=n.val();if(null===e)throw new Error("404");return Object.assign({id:t.id},e)}).then(t=>n.remove().then(()=>group))})},createOrganization(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);return new Promise(n=>{const e=d.push(t,()=>{n(Object.assign({id:e.key},t))})})})},updateOrganization(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);const n=d.child(t.id);return n.once("value").then(n=>{const t=n.val();if(null===t)throw new Error("404");return t}).then(e=>{const i=Object.assign(e,t);return delete i.id,n.set(i).then(()=>Object.assign({id:t.id},i))})})},deleteOrganization(n,{input:t},{token:e}){return i(this,void 0,void 0,function*(){yield r.auth().verifyIdToken(e);const n=s.child(t.id);return n.once("value").then(n=>{const e=n.val();if(null===e)throw new Error("404");return Object.assign({id:t.id},e)}).then(t=>n.remove().then(()=>t))})}}}},function(n,t){n.exports=require("graphql-tools")},function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=e(8),r=e(7),o=e(5),u=e(4),a=e(3),s=e(2),d=e(1);n.exports=i.makeExecutableSchema({typeDefs:["\n  schema {\n    query: Query\n    mutation: Mutation\n  }\n","\n  type Query {\n    approvals: [Approval]\n    approval(id: String!): Approval\n\n    devices: [Device]\n    device(id: String!): Device\n\n    connections: [Connection]\n    connection(id: String!): Connection\n\n    groups: [Group]\n    group(id: String!): Group\n\n    organizations: [Organization]\n    organization(id: String!): Organization\n  }\n","\n  type Mutation {\n    createApproval(input: ApprovalCreateInput!): Approval\n    updateApproval(input: ApprovalInput): Approval\n    deleteApproval(input: ApprovalDeleteInput): Approval\n\n    createDevice(input: DeviceCreateInput!): Device\n    updateDevice(input: DeviceInput): Device\n    deleteDevice(input: DeviceDeleteInput): Device\n\n    createConnection(input: ConnectionCreateInput!): Connection\n    updateConnection(input: ConnectionInput): Connection\n    deleteConnection(input: ConnectionDeleteInput): Connection\n\n    createGroup(input: GroupCreateInput!): Group\n    updateGroup(input: GroupInput): Group\n    deleteGroup(input: GroupDeleteInput): Group\n\n    createOrganization(input: OrganizationCreateInput!): Organization\n    updateOrganization(input: OrganizationInput): Organization\n    deleteOrganization(input: OrganizationDeleteInput):Organization\n\n  }\n",o,u,a,s,d],resolvers:r})},function(n,t){n.exports=require("graphql/utilities/schemaPrinter")},function(n,t){n.exports=require("apollo-server-express")},function(n,t){n.exports=require("cors")},function(n,t){n.exports=require("express")},function(n,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=e(13),r=e(12),o=e(0),u=e(11),a=e(10),s=e(9),d=i();d.use(r()),d.options("*",r()),d.use((n,t,e)=>(console.log("req:",n),console.log("token:",n.header("Authentication")),t.setHeader("Cache-Control","no-cache, no-store, must-revalidate"),e())),d.use("/graphql",u.graphqlExpress(n=>({schema:s,context:{token:n.header("Authentication")}}))),d.use("/graphiql",u.graphiqlExpress(n=>({endpointURL:"/api/graphql",context:{token:n.header("Authentication")}}))),d.use("/schema",(n,t)=>{t.set("Content-Type","text/plain"),t.send(a.printSchema(s))}),t.api=o.https.onRequest(d)}]));